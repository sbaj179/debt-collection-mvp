{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/AppShell.module.css [app-client] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"active\": \"AppShell-module__JCX2KW__active\",\n  \"content\": \"AppShell-module__JCX2KW__content\",\n  \"header\": \"AppShell-module__JCX2KW__header\",\n  \"page\": \"AppShell-module__JCX2KW__page\",\n  \"sidebar\": \"AppShell-module__JCX2KW__sidebar\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sibabalo/Debt_Collection_mvp/debt-collection-mvp/components/AppShell.tsx"],"sourcesContent":["'use client';\r\n\r\nimport Link from 'next/link';\r\nimport { usePathname } from 'next/navigation';\r\nimport styles from './AppShell.module.css';\r\n\r\nconst navItems = [\r\n  ['Dashboard', '/dashboard'],\r\n  ['Customers', '/customers'],\r\n  ['Invoices', '/invoices'],\r\n  ['Payments', '/payments'],\r\n  ['Automations', '/automations'],\r\n  ['Templates', '/templates'],\r\n  ['Reports', '/reports'],\r\n  ['Settings', '/settings']\r\n];\r\n\r\nexport function AppShell({ title, children }: { title: string; children: React.ReactNode }) {\r\n  const pathname = usePathname();\r\n\r\n  return (\r\n    <main className={styles.page}>\r\n      <aside className={styles.sidebar}>\r\n        <h1>Get Paid Faster</h1>\r\n        <p>Collections automation</p>\r\n        <nav>\r\n          {navItems.map(([label, href]) => (\r\n            <Link key={href} href={href} className={pathname === href ? styles.active : ''}>\r\n              {label}\r\n            </Link>\r\n          ))}\r\n        </nav>\r\n      </aside>\r\n      <section className={styles.content}>\r\n        <header className={styles.header}>\r\n          <h2>{title}</h2>\r\n          <button type=\"button\">+ Create invoice</button>\r\n        </header>\r\n        {children}\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;AAJA;;;;AAMA,MAAM,WAAW;IACf;QAAC;QAAa;KAAa;IAC3B;QAAC;QAAa;KAAa;IAC3B;QAAC;QAAY;KAAY;IACzB;QAAC;QAAY;KAAY;IACzB;QAAC;QAAe;KAAe;IAC/B;QAAC;QAAa;KAAa;IAC3B;QAAC;QAAW;KAAW;IACvB;QAAC;QAAY;KAAY;CAC1B;AAEM,SAAS,SAAS,EAAE,KAAK,EAAE,QAAQ,EAAgD;;IACxF,MAAM,WAAW,IAAA,oJAAW;IAE5B,qBACE,6LAAC;QAAK,WAAW,gJAAM,CAAC,IAAI;;0BAC1B,6LAAC;gBAAM,WAAW,gJAAM,CAAC,OAAO;;kCAC9B,6LAAC;kCAAG;;;;;;kCACJ,6LAAC;kCAAE;;;;;;kCACH,6LAAC;kCACE,SAAS,GAAG,CAAC,CAAC,CAAC,OAAO,KAAK,iBAC1B,6LAAC,0KAAI;gCAAY,MAAM;gCAAM,WAAW,aAAa,OAAO,gJAAM,CAAC,MAAM,GAAG;0CACzE;+BADQ;;;;;;;;;;;;;;;;0BAMjB,6LAAC;gBAAQ,WAAW,gJAAM,CAAC,OAAO;;kCAChC,6LAAC;wBAAO,WAAW,gJAAM,CAAC,MAAM;;0CAC9B,6LAAC;0CAAI;;;;;;0CACL,6LAAC;gCAAO,MAAK;0CAAS;;;;;;;;;;;;oBAEvB;;;;;;;;;;;;;AAIT;GAzBgB;;QACG,oJAAW;;;KADd"}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sibabalo/Debt_Collection_mvp/debt-collection-mvp/app/invoices/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { AppShell } from \"@/components/AppShell\";\r\nimport { createClient } from \"@supabase/supabase-js\";\r\nimport {\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useState,\r\n  type CSSProperties,\r\n  type FormEvent,\r\n} from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\ntype Channel = \"WHATSAPP\" | \"SMS\" | \"EMAIL\";\r\n\r\ntype InvoiceStatus =\r\n  | \"DRAFT\"\r\n  | \"SENT\"\r\n  | \"PAID\"\r\n  | \"OVERDUE\"\r\n  | \"PARTIALLY_PAID\"\r\n  | \"DISPUTED\"\r\n  | string;\r\n\r\ntype CustomerLite = {\r\n  id: string;\r\n  name: string;\r\n  phone: string | null;\r\n  email: string | null;\r\n  preferred_channel: Channel | null;\r\n};\r\n\r\ntype InvoiceRow = {\r\n  id: string;\r\n  invoice_number: string;\r\n  status: InvoiceStatus;\r\n  due_date: string | null;\r\n  total: number | null;\r\n  balance: number | null;\r\n  created_at: string;\r\n  disputeCount: number;\r\n};\r\n\r\ntype ItemDraft = {\r\n  description: string;\r\n  quantity: string;\r\n  unitPrice: string;\r\n};\r\n\r\ntype CleanItem = {\r\n  description: string;\r\n  quantity: number;\r\n  unitPrice: number;\r\n  amount: number;\r\n};\r\n\r\ntype DraftAnalysis = {\r\n  cleanItems: CleanItem[];\r\n  subtotal: number;\r\n  vatAmount: number;\r\n  total: number;\r\n  formErrors: string[];\r\n  lineErrors: string[];\r\n  allErrors: string[];\r\n  canSaveDraft: boolean;\r\n  canSaveSend: boolean;\r\n  sendBlockedReasons: string[];\r\n};\r\n\r\nfunction parseNum(v: string): number {\r\n  const n = Number(String(v ?? \"\").replace(\",\", \".\"));\r\n  return Number.isFinite(n) ? n : 0;\r\n}\r\n\r\nfunction round2(n: number): number {\r\n  return Math.round(n * 100) / 100;\r\n}\r\n\r\nfunction money(n: number): string {\r\n  const val = Number.isFinite(n) ? n : 0;\r\n  return `R ${val.toLocaleString(\"en-ZA\", {\r\n    minimumFractionDigits: 2,\r\n    maximumFractionDigits: 2,\r\n  })}`;\r\n}\r\n\r\nfunction nowIso(): string {\r\n  return new Date().toISOString();\r\n}\r\n\r\nfunction ymdToday(): string {\r\n  const d = new Date();\r\n  const y = d.getFullYear();\r\n  const m = String(d.getMonth() + 1).padStart(2, \"0\");\r\n  const day = String(d.getDate()).padStart(2, \"0\");\r\n  return `${y}-${m}-${day}`;\r\n}\r\n\r\nfunction formatDate(isoLike: string | null | undefined): string {\r\n  if (!isoLike) return \"—\";\r\n  const d = new Date(isoLike);\r\n  if (Number.isNaN(d.getTime())) return String(isoLike);\r\n  return d.toLocaleDateString(\"en-ZA\", {\r\n    year: \"numeric\",\r\n    month: \"short\",\r\n    day: \"2-digit\",\r\n  });\r\n}\r\n\r\nfunction daysFromToday(dateStr: string | null): number | null {\r\n  if (!dateStr) return null;\r\n  const today = new Date();\r\n  const due = new Date(dateStr);\r\n  if (Number.isNaN(due.getTime())) return null;\r\n\r\n  const t0 = new Date(today.getFullYear(), today.getMonth(), today.getDate()).getTime();\r\n  const d0 = new Date(due.getFullYear(), due.getMonth(), due.getDate()).getTime();\r\n\r\n  return Math.round((d0 - t0) / (1000 * 60 * 60 * 24));\r\n}\r\n\r\nfunction makeUuid(): string {\r\n  if (typeof crypto !== \"undefined\" && \"randomUUID\" in crypto) {\r\n    return crypto.randomUUID();\r\n  }\r\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, (c) => {\r\n    const r = (Math.random() * 16) | 0;\r\n    const v = c === \"x\" ? r : (r & 0x3) | 0x8;\r\n    return v.toString(16);\r\n  });\r\n}\r\n\r\nfunction makeInvoiceNumber(seedId: string): string {\r\n  // Fallback/local number to satisfy NOT NULL if trigger logic is conditional.\r\n  // DB trigger may override this value.\r\n  const d = new Date();\r\n  const yyyy = d.getFullYear();\r\n  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\r\n  const dd = String(d.getDate()).padStart(2, \"0\");\r\n  const hh = String(d.getHours()).padStart(2, \"0\");\r\n  const mi = String(d.getMinutes()).padStart(2, \"0\");\r\n  const ss = String(d.getSeconds()).padStart(2, \"0\");\r\n  const suffix = seedId.replace(/-/g, \"\").slice(0, 6).toUpperCase();\r\n  return `INV-${yyyy}${mm}${dd}-${hh}${mi}${ss}-${suffix}`;\r\n}\r\n\r\nasync function sha256Hex(input: string): Promise<string> {\r\n  try {\r\n    if (\r\n      typeof crypto === \"undefined\" ||\r\n      !(\"subtle\" in crypto) ||\r\n      !crypto.subtle\r\n    ) {\r\n      return input;\r\n    }\r\n    const enc = new TextEncoder();\r\n    const buf = await crypto.subtle.digest(\"SHA-256\", enc.encode(input));\r\n    return Array.from(new Uint8Array(buf))\r\n      .map((b) => b.toString(16).padStart(2, \"0\"))\r\n      .join(\"\");\r\n  } catch {\r\n    return input;\r\n  }\r\n}\r\n\r\nfunction eMsg(e: any, fallback = \"Something went wrong\"): string {\r\n  return e?.message || e?.error_description || e?.details || e?.hint || fallback;\r\n}\r\n\r\nfunction friendlyInvoiceItemsInsertError(err: any): string {\r\n  const raw = eMsg(err, \"Invoice items insert failed.\");\r\n  const m = raw.toLowerCase();\r\n\r\n  // This is the common trap with your current trigger setup:\r\n  // invoice_items insert fires trigger -> trigger updates invoices -> invoices UPDATE blocked by RLS\r\n  if (\r\n    m.includes(\"row-level security\") &&\r\n    m.includes(\"invoices\")\r\n  ) {\r\n    return \"Invoice items insert failed because the invoice_items trigger recalculates the parent invoice totals, but your current RLS likely blocks UPDATE on invoices for this user/org. Check invoices UPDATE policy (trigger side-effect).\";\r\n  }\r\n\r\n  return raw;\r\n}\r\n\r\nfunction analyzeDraft(opts: {\r\n  items: ItemDraft[];\r\n  customerId: string;\r\n  dueDate: string;\r\n  vatEnabled: boolean;\r\n  vatRate: string;\r\n  selectedCustomer: CustomerLite | null;\r\n}): DraftAnalysis {\r\n  const { items, customerId, dueDate, vatEnabled, vatRate, selectedCustomer } = opts;\r\n\r\n  const lineErrors: string[] = [];\r\n  const cleanItems: CleanItem[] = [];\r\n\r\n  items.forEach((it, idx) => {\r\n    const description = it.description.trim();\r\n    const quantity = parseNum(it.quantity);\r\n    const unitPrice = round2(parseNum(it.unitPrice));\r\n    const amount = round2(quantity * unitPrice);\r\n    const lineNum = idx + 1;\r\n\r\n    // Treat a row as untouched only if literally blank.\r\n    const rowUntouched =\r\n      !description &&\r\n      String(it.quantity ?? \"\").trim() === \"\" &&\r\n      String(it.unitPrice ?? \"\").trim() === \"\";\r\n\r\n    if (rowUntouched) return;\r\n\r\n    if (!description) lineErrors.push(`Item ${lineNum}: description is required.`);\r\n    if (!(quantity > 0)) lineErrors.push(`Item ${lineNum}: quantity must be greater than 0.`);\r\n    if (unitPrice < 0) lineErrors.push(`Item ${lineNum}: unit price cannot be negative.`);\r\n\r\n    if (description && quantity > 0 && unitPrice >= 0) {\r\n      cleanItems.push({ description, quantity, unitPrice, amount });\r\n    }\r\n  });\r\n\r\n  const formErrors: string[] = [];\r\n  if (!customerId) formErrors.push(\"Customer is required.\");\r\n  if (!dueDate) formErrors.push(\"Due date is required.\");\r\n\r\n  const vatRateNum = parseNum(vatRate);\r\n  if (vatEnabled && !(vatRateNum >= 0)) {\r\n    formErrors.push(\"VAT rate must be 0 or greater.\");\r\n  }\r\n\r\n  if (cleanItems.length === 0) {\r\n    formErrors.push(\"At least one valid line item is required.\");\r\n  }\r\n\r\n  const subtotal = round2(cleanItems.reduce((acc, it) => acc + it.amount, 0));\r\n  const vatAmount = vatEnabled ? round2(subtotal * (Math.max(0, vatRateNum) / 100)) : 0;\r\n  const total = round2(subtotal + vatAmount);\r\n\r\n  const canSaveDraft =\r\n    formErrors.length === 0 &&\r\n    lineErrors.length === 0 &&\r\n    Number.isFinite(total) &&\r\n    total >= 0;\r\n\r\n  // Save & send assumes SMS queue path (requires phone)\r\n  const canSaveSend = canSaveDraft && !!selectedCustomer?.phone;\r\n\r\n  const sendBlockedReasons = [...formErrors, ...lineErrors];\r\n  if (canSaveDraft && !selectedCustomer?.phone) {\r\n    sendBlockedReasons.push(\"Selected customer needs a phone number to send via SMS.\");\r\n  }\r\n\r\n  return {\r\n    cleanItems,\r\n    subtotal,\r\n    vatAmount,\r\n    total,\r\n    formErrors,\r\n    lineErrors,\r\n    allErrors: [...formErrors, ...lineErrors],\r\n    canSaveDraft,\r\n    canSaveSend,\r\n    sendBlockedReasons,\r\n  };\r\n}\r\n\r\nfunction pageCard(extra?: CSSProperties): CSSProperties {\r\n  return {\r\n    borderRadius: 22,\r\n    border: \"1px solid rgba(255,255,255,0.10)\",\r\n    background:\r\n      \"linear-gradient(180deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.02) 100%), rgba(8,10,14,0.72)\",\r\n    boxShadow: \"0 18px 40px rgba(0,0,0,0.24)\",\r\n    backdropFilter: \"blur(10px)\",\r\n    ...extra,\r\n  };\r\n}\r\n\r\nfunction sectionCard(extra?: CSSProperties): CSSProperties {\r\n  return {\r\n    padding: \"1rem\",\r\n    borderRadius: 16,\r\n    border: \"1px solid rgba(255,255,255,0.08)\",\r\n    background: \"rgba(255,255,255,0.03)\",\r\n    ...extra,\r\n  };\r\n}\r\n\r\nfunction fieldWrapStyle(hasError = false): CSSProperties {\r\n  return {\r\n    display: \"grid\",\r\n    gap: 6,\r\n    padding: \"0.65rem\",\r\n    borderRadius: 12,\r\n    border: hasError\r\n      ? \"1px solid rgba(239,68,68,0.45)\"\r\n      : \"1px solid rgba(255,255,255,0.08)\",\r\n    background: hasError ? \"rgba(239,68,68,0.06)\" : \"rgba(255,255,255,0.02)\",\r\n  };\r\n}\r\n\r\nfunction statusBadgeStyle(status: string): CSSProperties {\r\n  const s = String(status || \"\").toUpperCase();\r\n\r\n  const base: CSSProperties = {\r\n    display: \"inline-flex\",\r\n    alignItems: \"center\",\r\n    gap: 6,\r\n    padding: \"0.28rem 0.65rem\",\r\n    borderRadius: 999,\r\n    fontSize: 12,\r\n    fontWeight: 700,\r\n    border: \"1px solid rgba(255,255,255,0.12)\",\r\n    background: \"rgba(255,255,255,0.04)\",\r\n    color: \"rgba(255,255,255,0.95)\",\r\n    whiteSpace: \"nowrap\",\r\n    letterSpacing: \"0.02em\",\r\n  };\r\n\r\n  if (s === \"PAID\") {\r\n    return {\r\n      ...base,\r\n      background: \"rgba(34,197,94,0.16)\",\r\n      border: \"1px solid rgba(34,197,94,0.38)\",\r\n    };\r\n  }\r\n  if (s === \"OVERDUE\") {\r\n    return {\r\n      ...base,\r\n      background: \"rgba(239,68,68,0.15)\",\r\n      border: \"1px solid rgba(239,68,68,0.38)\",\r\n    };\r\n  }\r\n  if (s === \"SENT\" || s === \"PARTIALLY_PAID\") {\r\n    return {\r\n      ...base,\r\n      background: \"rgba(245,158,11,0.16)\",\r\n      border: \"1px solid rgba(245,158,11,0.38)\",\r\n    };\r\n  }\r\n  if (s === \"DRAFT\") {\r\n    return {\r\n      ...base,\r\n      background: \"rgba(148,163,184,0.14)\",\r\n      border: \"1px solid rgba(148,163,184,0.32)\",\r\n    };\r\n  }\r\n  if (s === \"DISPUTED\") {\r\n    return {\r\n      ...base,\r\n      background: \"rgba(244,63,94,0.16)\",\r\n      border: \"1px solid rgba(244,63,94,0.34)\",\r\n    };\r\n  }\r\n\r\n  return base;\r\n}\r\n\r\nexport default function InvoicesPage() {\r\n  const router = useRouter();\r\n\r\n  const supabase = useMemo(() => {\r\n    const url = process.env.NEXT_PUBLIC_SUPABASE_URL!;\r\n    const key = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\r\n    if (!url || !key) {\r\n      throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY\");\r\n    }\r\n    return createClient(url, key);\r\n  }, []);\r\n\r\n  const [err, setErr] = useState<string | null>(null);\r\n  const [info, setInfo] = useState<string | null>(null);\r\n  const [loadingPage, setLoadingPage] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n\r\n  const [customers, setCustomers] = useState<CustomerLite[]>([]);\r\n  const [recent, setRecent] = useState<InvoiceRow[]>([]);\r\n\r\n  const [showBuilder, setShowBuilder] = useState(false);\r\n  const [customerSearch, setCustomerSearch] = useState(\"\");\r\n  const [customerId, setCustomerId] = useState(\"\");\r\n  const [dueDate, setDueDate] = useState(\"\");\r\n  const [vatEnabled, setVatEnabled] = useState(false);\r\n  const [vatRate, setVatRate] = useState(\"15\");\r\n  const [items, setItems] = useState<ItemDraft[]>([\r\n    { description: \"\", quantity: \"1\", unitPrice: \"0\" },\r\n  ]);\r\n\r\n  const currency = \"ZAR\";\r\n\r\n  const requireSession = useCallback(async () => {\r\n    const { data, error } = await supabase.auth.getSession();\r\n    if (error) throw error;\r\n    if (!data.session) {\r\n      router.push(\"/auth/signin\");\r\n      throw new Error(\"No active session.\");\r\n    }\r\n    return data.session;\r\n  }, [router, supabase]);\r\n\r\n  const resolveActiveOrgIdStrict = useCallback(async (): Promise<string> => {\r\n    const stored = typeof window !== \"undefined\" ? localStorage.getItem(\"active_org_id\") : null;\r\n\r\n    const memRes = await supabase.from(\"org_memberships\").select(\"org_id\").limit(200);\r\n    if (memRes.error) throw memRes.error;\r\n\r\n    const memberships = (memRes.data ?? []) as Array<{ org_id: string }>;\r\n    if (memberships.length === 0) {\r\n      throw new Error(\"No organization membership found for this user.\");\r\n    }\r\n\r\n    const validSet = new Set(memberships.map((m) => String(m.org_id)));\r\n    const resolved = stored && validSet.has(stored) ? stored : String(memberships[0].org_id);\r\n\r\n    if (typeof window !== \"undefined\") {\r\n      localStorage.setItem(\"active_org_id\", resolved);\r\n    }\r\n\r\n    return resolved;\r\n  }, [supabase]);\r\n\r\n  const filteredCustomers = useMemo(() => {\r\n    const s = customerSearch.trim().toLowerCase();\r\n    if (!s) return customers;\r\n    return customers.filter((c) => {\r\n      return (\r\n        c.name.toLowerCase().includes(s) ||\r\n        (c.phone ?? \"\").toLowerCase().includes(s) ||\r\n        (c.email ?? \"\").toLowerCase().includes(s)\r\n      );\r\n    });\r\n  }, [customerSearch, customers]);\r\n\r\n  const selectedCustomer = useMemo(\r\n    () => customers.find((c) => c.id === customerId) ?? null,\r\n    [customers, customerId]\r\n  );\r\n\r\n  const draftAnalysis = useMemo(\r\n    () =>\r\n      analyzeDraft({\r\n        items,\r\n        customerId,\r\n        dueDate,\r\n        vatEnabled,\r\n        vatRate,\r\n        selectedCustomer,\r\n      }),\r\n    [items, customerId, dueDate, vatEnabled, vatRate, selectedCustomer]\r\n  );\r\n\r\n  const metrics = useMemo(() => {\r\n    return {\r\n      customers: customers.length,\r\n      drafts: recent.filter((r) => String(r.status).toUpperCase() === \"DRAFT\").length,\r\n      sentActive: recent.filter((r) =>\r\n        [\"SENT\", \"PARTIALLY_PAID\", \"OVERDUE\"].includes(String(r.status).toUpperCase())\r\n      ).length,\r\n      outstandingValue: recent.reduce((acc, r) => acc + Number(r.balance ?? 0), 0),\r\n      disputes: recent.reduce((acc, r) => acc + Number(r.disputeCount ?? 0), 0),\r\n    };\r\n  }, [customers.length, recent]);\r\n\r\n  const load = useCallback(async () => {\r\n    setErr(null);\r\n    setInfo(null);\r\n    setLoadingPage(true);\r\n\r\n    try {\r\n      await requireSession();\r\n      const orgId = await resolveActiveOrgIdStrict();\r\n\r\n      const [cRes, iRes] = await Promise.all([\r\n        supabase\r\n          .from(\"customers\")\r\n          .select(\"id,name,phone,email,preferred_channel\")\r\n          .eq(\"org_id\", orgId)\r\n          .order(\"created_at\", { ascending: false })\r\n          .limit(500),\r\n\r\n        supabase\r\n          .from(\"invoices\")\r\n          .select(\"id,invoice_number,status,due_date,total,balance,created_at\")\r\n          .eq(\"org_id\", orgId)\r\n          .order(\"created_at\", { ascending: false })\r\n          .limit(50),\r\n      ]);\r\n\r\n      if (cRes.error) throw cRes.error;\r\n      if (iRes.error) throw iRes.error;\r\n\r\n      const safeCustomers: CustomerLite[] = ((cRes.data ?? []) as any[]).map((r) => ({\r\n        id: String(r.id),\r\n        name: String(r.name ?? \"\"),\r\n        phone: r.phone ?? null,\r\n        email: r.email ?? null,\r\n        preferred_channel: (r.preferred_channel ?? null) as Channel | null,\r\n      }));\r\n\r\n      let safeInvoices: InvoiceRow[] = ((iRes.data ?? []) as any[]).map((r) => ({\r\n        id: String(r.id),\r\n        invoice_number: String(r.invoice_number ?? \"\"),\r\n        status: String(r.status ?? \"DRAFT\"),\r\n        due_date: (r.due_date ?? null) as string | null,\r\n        total: r.total == null ? null : Number(r.total),\r\n        balance: r.balance == null ? null : Number(r.balance),\r\n        created_at: String(r.created_at ?? nowIso()),\r\n        disputeCount: 0,\r\n      }));\r\n\r\n      // Optional enrichment only. Never block page.\r\n      try {\r\n        if (safeInvoices.length > 0) {\r\n          const dRes = await supabase\r\n            .from(\"invoice_disputes\")\r\n            .select(\"invoice_id\")\r\n            .in(\r\n              \"invoice_id\",\r\n              safeInvoices.map((i) => i.id)\r\n            );\r\n\r\n          if (!dRes.error && dRes.data) {\r\n            const counts = new Map<string, number>();\r\n            for (const row of dRes.data as any[]) {\r\n              const id = String(row.invoice_id);\r\n              counts.set(id, (counts.get(id) ?? 0) + 1);\r\n            }\r\n            safeInvoices = safeInvoices.map((inv) => ({\r\n              ...inv,\r\n              disputeCount: counts.get(inv.id) ?? 0,\r\n            }));\r\n          }\r\n        }\r\n      } catch {\r\n        // ignore optional dispute enrichment\r\n      }\r\n\r\n      setCustomers(safeCustomers);\r\n      setRecent(safeInvoices);\r\n    } catch (e: any) {\r\n      setErr(eMsg(e, \"Failed to load invoices page.\"));\r\n    } finally {\r\n      setLoadingPage(false);\r\n    }\r\n  }, [requireSession, resolveActiveOrgIdStrict, supabase]);\r\n\r\n  useEffect(() => {\r\n    load();\r\n  }, [load]);\r\n\r\n  function openBuilder() {\r\n    setErr(null);\r\n    setInfo(null);\r\n    setShowBuilder(true);\r\n    if (!dueDate) setDueDate(ymdToday());\r\n  }\r\n\r\n  function closeBuilder() {\r\n    setShowBuilder(false);\r\n  }\r\n\r\n  function resetBuilder() {\r\n    setCustomerSearch(\"\");\r\n    setCustomerId(\"\");\r\n    setDueDate(\"\");\r\n    setVatEnabled(false);\r\n    setVatRate(\"15\");\r\n    setItems([{ description: \"\", quantity: \"1\", unitPrice: \"0\" }]);\r\n    setShowBuilder(false);\r\n    setErr(null);\r\n  }\r\n\r\n  function addItemRow() {\r\n    setItems((prev) => [...prev, { description: \"\", quantity: \"1\", unitPrice: \"0\" }]);\r\n  }\r\n\r\n  function removeItemRow(idx: number) {\r\n    setItems((prev) => {\r\n      const next = prev.filter((_, i) => i !== idx);\r\n      return next.length > 0 ? next : [{ description: \"\", quantity: \"1\", unitPrice: \"0\" }];\r\n    });\r\n  }\r\n\r\n  function updateItem(idx: number, patch: Partial<ItemDraft>) {\r\n    setItems((prev) => prev.map((it, i) => (i === idx ? { ...it, ...patch } : it)));\r\n  }\r\n\r\n  async function queueInvoiceSentSms(opts: {\r\n    orgId: string;\r\n    invoiceId: string;\r\n    customerId: string;\r\n    invoiceNumber: string;\r\n    actorUserId?: string | null;\r\n  }) {\r\n    const { orgId, invoiceId, customerId, invoiceNumber, actorUserId = null } = opts;\r\n\r\n    const custRes = await supabase\r\n      .from(\"customers\")\r\n      .select(\"phone,opted_out,do_not_contact,consent\")\r\n      .eq(\"org_id\", orgId)\r\n      .eq(\"id\", customerId)\r\n      .single();\r\n\r\n    if (custRes.error) throw custRes.error;\r\n\r\n    const c = custRes.data as any;\r\n    if (!c?.phone) throw new Error(\"Customer has no phone number (required for SMS).\");\r\n    if (c.opted_out || c.do_not_contact || c.consent === false) {\r\n      throw new Error(\"Customer is not contactable (opted-out / do-not-contact / no consent).\");\r\n    }\r\n\r\n    const smsTplRes = await supabase\r\n      .from(\"message_templates\")\r\n      .select(\"id\")\r\n      .eq(\"org_id\", orgId)\r\n      .eq(\"channel\", \"SMS\")\r\n      .eq(\"name\", \"Invoice Sent\")\r\n      .limit(1)\r\n      .maybeSingle();\r\n\r\n    if (smsTplRes.error) throw smsTplRes.error;\r\n\r\n    let templateId = (smsTplRes.data as any)?.id as string | undefined;\r\n\r\n    if (!templateId) {\r\n      const waTplRes = await supabase\r\n        .from(\"message_templates\")\r\n        .select(\"id\")\r\n        .eq(\"org_id\", orgId)\r\n        .eq(\"channel\", \"WHATSAPP\")\r\n        .eq(\"name\", \"Invoice Sent\")\r\n        .limit(1)\r\n        .maybeSingle();\r\n\r\n      if (waTplRes.error) throw waTplRes.error;\r\n      templateId = (waTplRes.data as any)?.id as string | undefined;\r\n    }\r\n\r\n    if (!templateId) {\r\n      throw new Error(\"No 'Invoice Sent' template found. Run seed_org_defaults().\");\r\n    }\r\n\r\n    const messageKey = await sha256Hex(`${orgId}:${invoiceId}:INVOICE_SENT`);\r\n\r\n    const ins = await supabase.from(\"message_log\").insert({\r\n      org_id: orgId,\r\n      customer_id: customerId,\r\n      invoice_id: invoiceId,\r\n      rule_id: null,\r\n      template_id: templateId,\r\n      channel: \"SMS\",\r\n      status: \"QUEUED\",\r\n      message_key: messageKey,\r\n      scheduled_for: nowIso(),\r\n    });\r\n\r\n    if (ins.error && (ins.error as any).code !== \"23505\") throw ins.error;\r\n\r\n    // Optional event - ignore failures\r\n    try {\r\n      await supabase.from(\"events\").insert({\r\n        org_id: orgId,\r\n        actor_user_id: actorUserId,\r\n        event_type: \"invoice_sms_queued\",\r\n        entity_type: \"invoice\",\r\n        entity_id: invoiceId,\r\n        meta: { invoice_number: invoiceNumber, channel: \"SMS\" },\r\n      });\r\n    } catch {\r\n      // ignore\r\n    }\r\n  }\r\n\r\n  // IMPORTANT: invoice_items schema does NOT include org_id\r\n  async function insertInvoiceItemsSafe(params: {\r\n    invoiceId: string;\r\n    items: CleanItem[];\r\n  }) {\r\n    const { invoiceId, items } = params;\r\n\r\n    const rows = items.map((it, idx) => ({\r\n      invoice_id: invoiceId,\r\n      description: it.description,\r\n      quantity: it.quantity,\r\n      unit_price: it.unitPrice,\r\n      amount: it.amount,\r\n      sort_order: idx,\r\n    }));\r\n\r\n    const res = await supabase.from(\"invoice_items\").insert(rows);\r\n    if (res.error) throw res.error;\r\n  }\r\n\r\n  async function saveInvoice(mode: \"DRAFT\" | \"SENT\") {\r\n    setErr(null);\r\n    setInfo(null);\r\n\r\n    if (mode === \"DRAFT\" && !draftAnalysis.canSaveDraft) {\r\n      setErr(draftAnalysis.allErrors[0] ?? \"Please complete the required fields.\");\r\n      return;\r\n    }\r\n\r\n    if (mode === \"SENT\" && !draftAnalysis.canSaveSend) {\r\n      setErr(\r\n        draftAnalysis.sendBlockedReasons[0] ??\r\n          \"Please complete required fields before sending.\"\r\n      );\r\n      return;\r\n    }\r\n\r\n    setSaving(true);\r\n\r\n    try {\r\n      const session = await requireSession();\r\n      const orgId = await resolveActiveOrgIdStrict();\r\n\r\n      const invoiceId = makeUuid();\r\n      const localInvoiceNumber = makeInvoiceNumber(invoiceId);\r\n\r\n      // Keep explicit values aligned with your schema.\r\n      const invoicePayload: Record<string, any> = {\r\n        id: invoiceId,\r\n        org_id: orgId,\r\n        customer_id: customerId,\r\n        invoice_number: localInvoiceNumber, // NOT NULL; DB trigger may override\r\n        status: mode,\r\n        issue_date: ymdToday(),\r\n        due_date: dueDate || null,\r\n        sent_at: mode === \"SENT\" ? nowIso() : null,\r\n        currency,\r\n        subtotal: draftAnalysis.subtotal,\r\n        vat: draftAnalysis.vatAmount,\r\n        total: draftAnalysis.total,\r\n        balance: draftAnalysis.total,\r\n        created_by: session.user.id,\r\n      };\r\n\r\n      const invInsert = await supabase.from(\"invoices\").insert(invoicePayload);\r\n      if (invInsert.error) {\r\n        throw new Error(`Invoice insert failed: ${invInsert.error.message}`);\r\n      }\r\n\r\n      // Insert children (invoice_items) - no org_id column in your schema\r\n      try {\r\n        await insertInvoiceItemsSafe({\r\n          invoiceId,\r\n          items: draftAnalysis.cleanItems,\r\n        });\r\n      } catch (itemErr: any) {\r\n        // Best-effort rollback to avoid orphan parent rows\r\n        await supabase.from(\"invoices\").delete().eq(\"org_id\", orgId).eq(\"id\", invoiceId);\r\n\r\n        throw new Error(`Invoice items insert failed: ${friendlyInvoiceItemsInsertError(itemErr)}`);\r\n      }\r\n\r\n      // Read final invoice_number (trigger may have replaced it)\r\n      let finalInvoiceNumber = localInvoiceNumber;\r\n      try {\r\n        const invRead = await supabase\r\n          .from(\"invoices\")\r\n          .select(\"invoice_number\")\r\n          .eq(\"org_id\", orgId)\r\n          .eq(\"id\", invoiceId)\r\n          .maybeSingle();\r\n\r\n        if (!invRead.error && (invRead.data as any)?.invoice_number) {\r\n          finalInvoiceNumber = String((invRead.data as any).invoice_number);\r\n        }\r\n      } catch {\r\n        // non-fatal\r\n      }\r\n\r\n      // Optional event\r\n      try {\r\n        await supabase.from(\"events\").insert({\r\n          org_id: orgId,\r\n          actor_user_id: session.user.id,\r\n          event_type: mode === \"SENT\" ? \"invoice_sent\" : \"invoice_draft_created\",\r\n          entity_type: \"invoice\",\r\n          entity_id: invoiceId,\r\n          meta: {\r\n            invoice_number: finalInvoiceNumber,\r\n            customer_id: customerId,\r\n            subtotal: draftAnalysis.subtotal,\r\n            vat: draftAnalysis.vatAmount,\r\n            total: draftAnalysis.total,\r\n            source: \"invoices_page_rewrite_v3\",\r\n          },\r\n        });\r\n      } catch (eventErr) {\r\n        console.warn(\"[InvoicesPage] event insert failed\", eventErr);\r\n      }\r\n\r\n      if (mode === \"SENT\") {\r\n        try {\r\n          await queueInvoiceSentSms({\r\n            orgId,\r\n            invoiceId,\r\n            customerId,\r\n            invoiceNumber: finalInvoiceNumber,\r\n            actorUserId: session.user.id,\r\n          });\r\n          setInfo(`Invoice sent successfully: ${finalInvoiceNumber} (SMS queued).`);\r\n        } catch (smsErr: any) {\r\n          setInfo(`Invoice ${finalInvoiceNumber} saved, but SMS queue failed: ${eMsg(smsErr)}`);\r\n        }\r\n      } else {\r\n        setInfo(`Draft saved successfully: ${finalInvoiceNumber}`);\r\n      }\r\n\r\n      await load();\r\n      resetBuilder();\r\n    } catch (e: any) {\r\n      console.error(\"[InvoicesPage.saveInvoice] FAILED\", e);\r\n      setErr(eMsg(e, \"Failed to save invoice.\"));\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  }\r\n\r\n  function onBuilderSubmit(e: FormEvent) {\r\n    // Prevent accidental Enter-key submit from bypassing explicit buttons.\r\n    e.preventDefault();\r\n  }\r\n\r\n  return (\r\n    <AppShell title=\"Invoices\">\r\n      <section\r\n        className=\"panel\"\r\n        style={pageCard({\r\n          padding: \"1rem\",\r\n          borderRadius: 22,\r\n          overflow: \"hidden\",\r\n        })}\r\n      >\r\n        {/* Header */}\r\n        <div\r\n          style={sectionCard({\r\n            background:\r\n              \"radial-gradient(circle at top right, rgba(59,130,246,0.15), transparent 45%), radial-gradient(circle at top left, rgba(168,85,247,0.12), transparent 45%), rgba(255,255,255,0.02)\",\r\n          })}\r\n        >\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              justifyContent: \"space-between\",\r\n              alignItems: \"flex-start\",\r\n              gap: \"1rem\",\r\n              flexWrap: \"wrap\",\r\n            }}\r\n          >\r\n            <div style={{ minWidth: 260 }}>\r\n              <h3 style={{ margin: 0, fontSize: 22, lineHeight: 1.1 }}>Invoices</h3>\r\n              <p style={{ margin: \"0.45rem 0 0\", opacity: 0.82, maxWidth: 760 }}>\r\n                Create and send invoices with tenant-safe writes to <code>invoices</code> and{\" \"}\r\n                <code>invoice_items</code>. This page does <b>not</b> create{\" \"}\r\n                <code>invoice_disputes</code> during invoice creation.\r\n              </p>\r\n            </div>\r\n\r\n            <div style={{ display: \"flex\", gap: \"0.55rem\", flexWrap: \"wrap\" }}>\r\n              <button className=\"btn\" onClick={load} disabled={loadingPage || saving}>\r\n                {loadingPage ? \"Refreshing...\" : \"Refresh\"}\r\n              </button>\r\n\r\n              {!showBuilder ? (\r\n                <button className=\"btn primary\" onClick={openBuilder} disabled={loadingPage}>\r\n                  Create invoice\r\n                </button>\r\n              ) : (\r\n                <button className=\"btn\" onClick={closeBuilder} disabled={saving}>\r\n                  Close builder\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Notices */}\r\n        {err ? (\r\n          <div\r\n            style={sectionCard({\r\n              marginTop: \"0.9rem\",\r\n              border: \"1px solid rgba(239,68,68,0.34)\",\r\n              background: \"rgba(239,68,68,0.08)\",\r\n            })}\r\n          >\r\n            {err}\r\n          </div>\r\n        ) : null}\r\n\r\n        {info ? (\r\n          <div\r\n            style={sectionCard({\r\n              marginTop: \"0.9rem\",\r\n              border: \"1px solid rgba(59,130,246,0.28)\",\r\n              background: \"rgba(59,130,246,0.07)\",\r\n            })}\r\n          >\r\n            {info}\r\n          </div>\r\n        ) : null}\r\n\r\n        {/* Metrics */}\r\n        <div\r\n          style={{\r\n            marginTop: \"1rem\",\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"repeat(auto-fit, minmax(160px, 1fr))\",\r\n            gap: \"0.75rem\",\r\n          }}\r\n        >\r\n          <div style={sectionCard()}>\r\n            <div style={{ fontSize: 12, opacity: 0.74 }}>Clients</div>\r\n            <div style={{ fontSize: 24, fontWeight: 800, marginTop: 4 }}>{metrics.customers}</div>\r\n          </div>\r\n\r\n          <div style={sectionCard()}>\r\n            <div style={{ fontSize: 12, opacity: 0.74 }}>Draft invoices</div>\r\n            <div style={{ fontSize: 24, fontWeight: 800, marginTop: 4 }}>{metrics.drafts}</div>\r\n          </div>\r\n\r\n          <div style={sectionCard()}>\r\n            <div style={{ fontSize: 12, opacity: 0.74 }}>Sent / active</div>\r\n            <div style={{ fontSize: 24, fontWeight: 800, marginTop: 4 }}>{metrics.sentActive}</div>\r\n          </div>\r\n\r\n          <div style={sectionCard()}>\r\n            <div style={{ fontSize: 12, opacity: 0.74 }}>Outstanding (recent)</div>\r\n            <div style={{ fontSize: 18, fontWeight: 800, marginTop: 4 }}>\r\n              {money(metrics.outstandingValue)}\r\n            </div>\r\n          </div>\r\n\r\n          <div style={sectionCard()}>\r\n            <div style={{ fontSize: 12, opacity: 0.74 }}>Disputes (recent)</div>\r\n            <div style={{ fontSize: 24, fontWeight: 800, marginTop: 4 }}>{metrics.disputes}</div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Builder */}\r\n        {showBuilder && (\r\n          <form onSubmit={onBuilderSubmit} style={{ marginTop: \"1rem\", display: \"grid\", gap: \"0.9rem\" }}>\r\n            {draftAnalysis.allErrors.length > 0 ? (\r\n              <div\r\n                style={sectionCard({\r\n                  border: \"1px solid rgba(245,158,11,0.34)\",\r\n                  background: \"rgba(245,158,11,0.07)\",\r\n                })}\r\n              >\r\n                <div style={{ fontWeight: 700, marginBottom: 8 }}>\r\n                  Complete required fields before saving\r\n                </div>\r\n                <ul\r\n                  style={{\r\n                    margin: 0,\r\n                    paddingLeft: \"1rem\",\r\n                    opacity: 0.92,\r\n                    display: \"grid\",\r\n                    gap: 4,\r\n                  }}\r\n                >\r\n                  {draftAnalysis.allErrors.slice(0, 8).map((msg, idx) => (\r\n                    <li key={idx} style={{ fontSize: 13 }}>\r\n                      {msg}\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            ) : null}\r\n\r\n            <div\r\n              data-builder-grid=\"true\"\r\n              style={{\r\n                display: \"grid\",\r\n                gap: \"0.9rem\",\r\n                gridTemplateColumns: \"minmax(0, 1.55fr) minmax(0, 1fr)\",\r\n                alignItems: \"start\",\r\n              }}\r\n            >\r\n              {/* Left column */}\r\n              <div style={{ display: \"grid\", gap: \"0.9rem\", minWidth: 0 }}>\r\n                {/* Invoice setup */}\r\n                <div style={sectionCard()}>\r\n                  <div\r\n                    style={{\r\n                      display: \"flex\",\r\n                      justifyContent: \"space-between\",\r\n                      alignItems: \"center\",\r\n                      gap: 8,\r\n                      flexWrap: \"wrap\",\r\n                    }}\r\n                  >\r\n                    <div>\r\n                      <h4 style={{ margin: 0 }}>Invoice setup</h4>\r\n                      <div style={{ opacity: 0.7, fontSize: 12, marginTop: 4 }}>\r\n                        Select a client, due date, and VAT settings\r\n                      </div>\r\n                    </div>\r\n                    <span style={{ opacity: 0.6, fontSize: 12 }}>Step 1</span>\r\n                  </div>\r\n\r\n                  <div style={{ marginTop: \"0.85rem\", display: \"grid\", gap: \"0.75rem\" }}>\r\n                    <div style={fieldWrapStyle(false)}>\r\n                      <label style={{ fontSize: 12, opacity: 0.78 }}>Search clients</label>\r\n                      <input\r\n                        value={customerSearch}\r\n                        onChange={(e) => setCustomerSearch(e.target.value)}\r\n                        placeholder=\"Search by name / phone / email...\"\r\n                        style={{ width: \"100%\" }}\r\n                      />\r\n                    </div>\r\n\r\n                    <div style={fieldWrapStyle(!customerId)}>\r\n                      <label style={{ fontSize: 12, opacity: 0.78 }}>\r\n                        Client * ({filteredCustomers.length} shown / {customers.length} total)\r\n                      </label>\r\n                      <select\r\n                        value={customerId}\r\n                        onChange={(e) => setCustomerId(e.target.value)}\r\n                        style={{ width: \"100%\" }}\r\n                      >\r\n                        <option value=\"\">Select client...</option>\r\n                        {filteredCustomers.map((c) => (\r\n                          <option key={c.id} value={c.id}>\r\n                            {c.name}\r\n                            {c.phone ? ` • ${c.phone}` : \"\"}\r\n                            {c.email ? ` • ${c.email}` : \"\"}\r\n                          </option>\r\n                        ))}\r\n                      </select>\r\n                      {!customerId ? (\r\n                        <div style={{ fontSize: 12, color: \"rgba(248,113,113,0.95)\" }}>Required</div>\r\n                      ) : null}\r\n                    </div>\r\n\r\n                    <div\r\n                      style={{\r\n                        display: \"grid\",\r\n                        gridTemplateColumns: \"repeat(auto-fit, minmax(170px, 1fr))\",\r\n                        gap: \"0.7rem\",\r\n                      }}\r\n                    >\r\n                      <div style={fieldWrapStyle(!dueDate)}>\r\n                        <label style={{ fontSize: 12, opacity: 0.78 }}>Due date *</label>\r\n                        <input\r\n                          type=\"date\"\r\n                          value={dueDate}\r\n                          onChange={(e) => setDueDate(e.target.value)}\r\n                          style={{ width: \"100%\" }}\r\n                        />\r\n                        {!dueDate ? (\r\n                          <div style={{ fontSize: 12, color: \"rgba(248,113,113,0.95)\" }}>Required</div>\r\n                        ) : null}\r\n                      </div>\r\n\r\n                      <div style={fieldWrapStyle(false)}>\r\n                        <label style={{ fontSize: 12, opacity: 0.78 }}>Currency</label>\r\n                        <input value={currency} readOnly style={{ width: \"100%\" }} />\r\n                        <div style={{ fontSize: 12, opacity: 0.62 }}>Fixed for now</div>\r\n                      </div>\r\n\r\n                      <div style={fieldWrapStyle(vatEnabled && parseNum(vatRate) < 0)}>\r\n                        <label style={{ fontSize: 12, opacity: 0.78 }}>VAT rate (%)</label>\r\n                        <input\r\n                          value={vatRate}\r\n                          onChange={(e) => setVatRate(e.target.value)}\r\n                          disabled={!vatEnabled}\r\n                          placeholder=\"15\"\r\n                          style={{ width: \"100%\" }}\r\n                        />\r\n                        <div style={{ fontSize: 12, opacity: vatEnabled ? 0.7 : 0.45 }}>\r\n                          {vatEnabled ? \"Applied to subtotal\" : \"Disabled\"}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div\r\n                      style={sectionCard({\r\n                        padding: \"0.8rem\",\r\n                        background: \"rgba(255,255,255,0.02)\",\r\n                      })}\r\n                    >\r\n                      <div\r\n                        style={{\r\n                          display: \"flex\",\r\n                          justifyContent: \"space-between\",\r\n                          alignItems: \"center\",\r\n                          gap: 8,\r\n                          flexWrap: \"wrap\",\r\n                        }}\r\n                      >\r\n                        <div>\r\n                          <div style={{ fontWeight: 700, fontSize: 14 }}>VAT</div>\r\n                          <div style={{ opacity: 0.72, fontSize: 12 }}>Enable VAT on this invoice</div>\r\n                        </div>\r\n\r\n                        <label\r\n                          style={{\r\n                            display: \"inline-flex\",\r\n                            alignItems: \"center\",\r\n                            gap: 8,\r\n                            cursor: \"pointer\",\r\n                          }}\r\n                        >\r\n                          <input\r\n                            type=\"checkbox\"\r\n                            checked={vatEnabled}\r\n                            onChange={(e) => setVatEnabled(e.target.checked)}\r\n                          />\r\n                          <span>{vatEnabled ? \"Enabled\" : \"Disabled\"}</span>\r\n                        </label>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {selectedCustomer ? (\r\n                      <div\r\n                        style={sectionCard({\r\n                          padding: \"0.85rem\",\r\n                          background:\r\n                            \"radial-gradient(circle at top right, rgba(59,130,246,0.10), transparent 60%), rgba(255,255,255,0.02)\",\r\n                        })}\r\n                      >\r\n                        <div style={{ fontWeight: 700, marginBottom: 4 }}>Selected client</div>\r\n                        <div style={{ fontSize: 13, fontWeight: 600 }}>{selectedCustomer.name}</div>\r\n                        <div style={{ opacity: 0.72, fontSize: 12, marginTop: 2 }}>\r\n                          {selectedCustomer.phone || \"No phone\"} • {selectedCustomer.email || \"No email\"}\r\n                        </div>\r\n                        <div style={{ opacity: 0.72, fontSize: 12, marginTop: 2 }}>\r\n                          Preferred channel: {selectedCustomer.preferred_channel || \"Not set\"}\r\n                        </div>\r\n                        {!selectedCustomer.phone ? (\r\n                          <div\r\n                            style={{\r\n                              marginTop: 6,\r\n                              fontSize: 12,\r\n                              color: \"rgba(251,191,36,0.95)\",\r\n                            }}\r\n                          >\r\n                            Save draft is allowed. “Save & send” is disabled until this client has a phone number.\r\n                          </div>\r\n                        ) : null}\r\n                      </div>\r\n                    ) : null}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Line items */}\r\n                <div style={sectionCard()}>\r\n                  <div\r\n                    style={{\r\n                      display: \"flex\",\r\n                      justifyContent: \"space-between\",\r\n                      alignItems: \"center\",\r\n                      gap: 8,\r\n                      flexWrap: \"wrap\",\r\n                    }}\r\n                  >\r\n                    <div>\r\n                      <h4 style={{ margin: 0 }}>Line items</h4>\r\n                      <div style={{ opacity: 0.7, fontSize: 12, marginTop: 4 }}>\r\n                        Add services / products and pricing\r\n                      </div>\r\n                    </div>\r\n\r\n                    <button className=\"btn\" type=\"button\" onClick={addItemRow}>\r\n                      + Add item\r\n                    </button>\r\n                  </div>\r\n\r\n                  <div style={{ marginTop: \"0.9rem\", display: \"grid\", gap: \"0.75rem\" }}>\r\n                    {items.map((it, idx) => {\r\n                      const qty = parseNum(it.quantity);\r\n                      const price = round2(parseNum(it.unitPrice));\r\n                      const lineTotal = round2(qty * price);\r\n\r\n                      const descMissing = it.description.trim().length === 0;\r\n                      const qtyInvalid = !(qty > 0);\r\n                      const priceInvalid = price < 0;\r\n\r\n                      const hasUserInput =\r\n                        it.description.trim().length > 0 ||\r\n                        String(it.quantity).trim() !== \"\" ||\r\n                        String(it.unitPrice).trim() !== \"\";\r\n\r\n                      const showErrors = hasUserInput || items.length === 1;\r\n                      const hasErrors = showErrors && (descMissing || qtyInvalid || priceInvalid);\r\n\r\n                      return (\r\n                        <div\r\n                          key={idx}\r\n                          style={sectionCard({\r\n                            padding: \"0.9rem\",\r\n                            borderRadius: 14,\r\n                            border: hasErrors\r\n                              ? \"1px solid rgba(239,68,68,0.28)\"\r\n                              : \"1px solid rgba(255,255,255,0.08)\",\r\n                            background: hasErrors\r\n                              ? \"rgba(239,68,68,0.04)\"\r\n                              : \"rgba(255,255,255,0.02)\",\r\n                          })}\r\n                        >\r\n                          <div\r\n                            style={{\r\n                              display: \"flex\",\r\n                              justifyContent: \"space-between\",\r\n                              alignItems: \"center\",\r\n                              gap: \"0.75rem\",\r\n                              marginBottom: \"0.7rem\",\r\n                              flexWrap: \"wrap\",\r\n                            }}\r\n                          >\r\n                            <div style={{ fontWeight: 700 }}>Item #{idx + 1}</div>\r\n\r\n                            {items.length > 1 ? (\r\n                              <button\r\n                                className=\"btn\"\r\n                                type=\"button\"\r\n                                onClick={() => removeItemRow(idx)}\r\n                              >\r\n                                Remove\r\n                              </button>\r\n                            ) : (\r\n                              <span style={{ opacity: 0.6, fontSize: 12 }}>\r\n                                At least one item required\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n\r\n                          <div style={{ display: \"grid\", gap: \"0.65rem\" }}>\r\n                            <div style={fieldWrapStyle(showErrors && descMissing)}>\r\n                              <label style={{ fontSize: 12, opacity: 0.78 }}>Description *</label>\r\n                              <input\r\n                                value={it.description}\r\n                                onChange={(e) => updateItem(idx, { description: e.target.value })}\r\n                                placeholder=\"e.g., Monthly cleaning — Feb 2026\"\r\n                                style={{ width: \"100%\" }}\r\n                              />\r\n                              {showErrors && descMissing ? (\r\n                                <div style={{ fontSize: 12, color: \"rgba(248,113,113,0.95)\" }}>\r\n                                  Required\r\n                                </div>\r\n                              ) : null}\r\n                            </div>\r\n\r\n                            <div\r\n                              style={{\r\n                                display: \"grid\",\r\n                                gridTemplateColumns: \"repeat(auto-fit, minmax(140px, 1fr))\",\r\n                                gap: \"0.6rem\",\r\n                              }}\r\n                            >\r\n                              <div style={fieldWrapStyle(showErrors && qtyInvalid)}>\r\n                                <label style={{ fontSize: 12, opacity: 0.78 }}>Qty *</label>\r\n                                <input\r\n                                  value={it.quantity}\r\n                                  onChange={(e) => updateItem(idx, { quantity: e.target.value })}\r\n                                  placeholder=\"1\"\r\n                                  style={{ width: \"100%\" }}\r\n                                />\r\n                                {showErrors && qtyInvalid ? (\r\n                                  <div style={{ fontSize: 12, color: \"rgba(248,113,113,0.95)\" }}>\r\n                                    Must be &gt; 0\r\n                                  </div>\r\n                                ) : null}\r\n                              </div>\r\n\r\n                              <div style={fieldWrapStyle(showErrors && priceInvalid)}>\r\n                                <label style={{ fontSize: 12, opacity: 0.78 }}>Unit price *</label>\r\n                                <input\r\n                                  value={it.unitPrice}\r\n                                  onChange={(e) => updateItem(idx, { unitPrice: e.target.value })}\r\n                                  placeholder=\"0\"\r\n                                  style={{ width: \"100%\" }}\r\n                                />\r\n                                {showErrors && priceInvalid ? (\r\n                                  <div style={{ fontSize: 12, color: \"rgba(248,113,113,0.95)\" }}>\r\n                                    Cannot be negative\r\n                                  </div>\r\n                                ) : null}\r\n                              </div>\r\n\r\n                              <div style={fieldWrapStyle(false)}>\r\n                                <label style={{ fontSize: 12, opacity: 0.78 }}>Line total</label>\r\n                                <input value={money(lineTotal)} readOnly style={{ width: \"100%\" }} />\r\n                                <div style={{ fontSize: 12, opacity: 0.62 }}>Auto-calculated</div>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n\r\n                  <div style={{ marginTop: \"0.75rem\", fontSize: 12, opacity: 0.68 }}>\r\n                    This page writes to <b>invoices</b> + <b>invoice_items</b>. It does <b>not</b>{\" \"}\r\n                    create <b>invoice_disputes</b> during invoice creation.\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Right column */}\r\n              <div style={{ display: \"grid\", gap: \"0.9rem\", minWidth: 0 }}>\r\n                <div\r\n                  data-summary-card=\"true\"\r\n                  style={sectionCard({\r\n                    position: \"static\",\r\n                    top: 12,\r\n                    background:\r\n                      \"radial-gradient(circle at top right, rgba(16,185,129,0.10), transparent 55%), rgba(255,255,255,0.025)\",\r\n                  })}\r\n                >\r\n                  <div\r\n                    style={{\r\n                      display: \"flex\",\r\n                      justifyContent: \"space-between\",\r\n                      alignItems: \"center\",\r\n                      gap: 8,\r\n                      flexWrap: \"wrap\",\r\n                    }}\r\n                  >\r\n                    <div>\r\n                      <h4 style={{ margin: 0 }}>Totals & actions</h4>\r\n                      <div style={{ opacity: 0.7, fontSize: 12, marginTop: 4 }}>\r\n                        Review then save or send\r\n                      </div>\r\n                    </div>\r\n                    <span style={{ opacity: 0.6, fontSize: 12 }}>Step 2</span>\r\n                  </div>\r\n\r\n                  <div style={{ marginTop: \"0.85rem\", display: \"grid\", gap: \"0.7rem\" }}>\r\n                    <div style={sectionCard({ padding: \"0.85rem\" })}>\r\n                      <div style={{ display: \"grid\", gap: \"0.55rem\" }}>\r\n                        <div style={{ display: \"flex\", justifyContent: \"space-between\", gap: 12 }}>\r\n                          <span style={{ opacity: 0.82 }}>Subtotal</span>\r\n                          <b>{money(draftAnalysis.subtotal)}</b>\r\n                        </div>\r\n\r\n                        <div style={{ display: \"flex\", justifyContent: \"space-between\", gap: 12 }}>\r\n                          <span style={{ opacity: 0.82 }}>\r\n                            VAT {vatEnabled ? `(${Math.max(0, parseNum(vatRate))}%)` : \"\"}\r\n                          </span>\r\n                          <b>{money(draftAnalysis.vatAmount)}</b>\r\n                        </div>\r\n\r\n                        <div\r\n                          style={{\r\n                            display: \"flex\",\r\n                            justifyContent: \"space-between\",\r\n                            gap: 12,\r\n                            marginTop: 4,\r\n                            paddingTop: 8,\r\n                            borderTop: \"1px solid rgba(255,255,255,0.08)\",\r\n                            fontSize: 16,\r\n                          }}\r\n                        >\r\n                          <span style={{ fontWeight: 800 }}>Total</span>\r\n                          <span style={{ fontWeight: 800 }}>{money(draftAnalysis.total)}</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div style={sectionCard({ padding: \"0.85rem\" })}>\r\n                      <div style={{ fontWeight: 700, marginBottom: 6 }}>Validation status</div>\r\n\r\n                      <div style={{ display: \"grid\", gap: 6, fontSize: 12 }}>\r\n                        <div>\r\n                          Draft save:{\" \"}\r\n                          <b\r\n                            style={{\r\n                              color: draftAnalysis.canSaveDraft\r\n                                ? \"rgba(74,222,128,0.95)\"\r\n                                : \"rgba(248,113,113,0.95)\",\r\n                            }}\r\n                          >\r\n                            {draftAnalysis.canSaveDraft ? \"Ready\" : \"Blocked\"}\r\n                          </b>\r\n                        </div>\r\n\r\n                        <div>\r\n                          Send (SMS):{\" \"}\r\n                          <b\r\n                            style={{\r\n                              color: draftAnalysis.canSaveSend\r\n                                ? \"rgba(74,222,128,0.95)\"\r\n                                : \"rgba(248,113,113,0.95)\",\r\n                            }}\r\n                          >\r\n                            {draftAnalysis.canSaveSend ? \"Ready\" : \"Blocked\"}\r\n                          </b>\r\n                        </div>\r\n\r\n                        {!draftAnalysis.canSaveSend && draftAnalysis.sendBlockedReasons.length > 0 ? (\r\n                          <div style={{ marginTop: 2, opacity: 0.78 }}>\r\n                            {draftAnalysis.sendBlockedReasons[0]}\r\n                          </div>\r\n                        ) : null}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div style={{ display: \"grid\", gap: \"0.65rem\", marginTop: 2 }}>\r\n                      <button\r\n                        className=\"btn primary\"\r\n                        type=\"button\"\r\n                        onClick={() => saveInvoice(\"SENT\")}\r\n                        disabled={saving || !draftAnalysis.canSaveSend}\r\n                        title={\r\n                          !draftAnalysis.canSaveSend\r\n                            ? draftAnalysis.sendBlockedReasons[0] ?? \"Complete required fields\"\r\n                            : \"\"\r\n                        }\r\n                      >\r\n                        {saving ? \"Processing...\" : \"Save & send (SMS queued)\"}\r\n                      </button>\r\n\r\n                      <button\r\n                        className=\"btn\"\r\n                        type=\"button\"\r\n                        onClick={() => saveInvoice(\"DRAFT\")}\r\n                        disabled={saving || !draftAnalysis.canSaveDraft}\r\n                        title={\r\n                          !draftAnalysis.canSaveDraft\r\n                            ? draftAnalysis.allErrors[0] ?? \"Complete required fields\"\r\n                            : \"\"\r\n                        }\r\n                      >\r\n                        {saving ? \"Saving...\" : \"Save draft\"}\r\n                      </button>\r\n\r\n                      <button className=\"btn\" type=\"button\" onClick={resetBuilder} disabled={saving}>\r\n                        Cancel\r\n                      </button>\r\n                    </div>\r\n\r\n                    <div\r\n                      style={sectionCard({\r\n                        padding: \"0.85rem\",\r\n                        background: \"rgba(255,255,255,0.02)\",\r\n                      })}\r\n                    >\r\n                      <div style={{ fontWeight: 700, marginBottom: 6, fontSize: 13 }}>\r\n                        DB write path\r\n                      </div>\r\n                      <div style={{ opacity: 0.76, fontSize: 12, lineHeight: 1.45 }}>\r\n                        <code>invoices</code> → <code>invoice_items</code> → optional <code>events</code> /{\" \"}\r\n                        <code>message_log</code>. If item insert fails with an RLS error mentioning{\" \"}\r\n                        <code>invoices</code>, the trigger that recalculates totals is likely blocked by\r\n                        missing <code>UPDATE</code> policy on <code>invoices</code>.\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        )}\r\n\r\n        {/* Recent invoices */}\r\n        <div style={{ marginTop: \"1rem\" }}>\r\n          <div\r\n            style={sectionCard({\r\n              padding: \"0.9rem 1rem\",\r\n              marginBottom: \"0.8rem\",\r\n              display: \"flex\",\r\n              justifyContent: \"space-between\",\r\n              alignItems: \"center\",\r\n              gap: \"0.75rem\",\r\n              flexWrap: \"wrap\",\r\n            })}\r\n          >\r\n            <div>\r\n              <h4 style={{ margin: 0 }}>Recent invoices</h4>\r\n              <div style={{ opacity: 0.72, fontSize: 12, marginTop: 4 }}>\r\n                Latest invoices for the active organization\r\n              </div>\r\n            </div>\r\n\r\n            <div style={{ opacity: 0.75, fontSize: 12 }}>\r\n              Showing {recent.length} invoice{recent.length === 1 ? \"\" : \"s\"}\r\n            </div>\r\n          </div>\r\n\r\n          {loadingPage ? (\r\n            <div style={sectionCard({ padding: \"1rem\" })}>Loading invoices...</div>\r\n          ) : recent.length === 0 ? (\r\n            <div style={sectionCard({ padding: \"1rem\" })}>\r\n              <div style={{ fontWeight: 700 }}>No invoices yet</div>\r\n              <div style={{ opacity: 0.75, marginTop: 4, fontSize: 13 }}>\r\n                Create your first invoice to test tenant-safe inserts and line item writes.\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <div\r\n              style={{\r\n                display: \"grid\",\r\n                gap: \"0.8rem\",\r\n                gridTemplateColumns: \"repeat(auto-fit, minmax(280px, 1fr))\",\r\n              }}\r\n            >\r\n              {recent.map((i) => {\r\n                const diff = daysFromToday(i.due_date);\r\n                const dueMeta =\r\n                  diff === null\r\n                    ? \"No due date\"\r\n                    : diff === 0\r\n                    ? \"Due today\"\r\n                    : diff > 0\r\n                    ? `Due in ${diff} day${diff === 1 ? \"\" : \"s\"}`\r\n                    : `${Math.abs(diff)} day${Math.abs(diff) === 1 ? \"\" : \"s\"} overdue`;\r\n\r\n                return (\r\n                  <div\r\n                    key={i.id}\r\n                    style={sectionCard({\r\n                      padding: \"0.95rem\",\r\n                      background:\r\n                        \"radial-gradient(circle at top right, rgba(99,102,241,0.08), transparent 60%), rgba(255,255,255,0.02)\",\r\n                    })}\r\n                  >\r\n                    <div\r\n                      style={{\r\n                        display: \"flex\",\r\n                        justifyContent: \"space-between\",\r\n                        gap: 8,\r\n                        alignItems: \"flex-start\",\r\n                        flexWrap: \"wrap\",\r\n                      }}\r\n                    >\r\n                      <div>\r\n                        <div style={{ fontWeight: 800, fontSize: 15 }}>\r\n                          {i.invoice_number || \"Invoice\"}\r\n                        </div>\r\n                        <div style={{ opacity: 0.68, fontSize: 12, marginTop: 2 }}>\r\n                          Created {formatDate(i.created_at)}\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div\r\n                        style={{\r\n                          display: \"flex\",\r\n                          gap: \"0.45rem\",\r\n                          alignItems: \"center\",\r\n                          flexWrap: \"wrap\",\r\n                        }}\r\n                      >\r\n                        {(i.disputeCount ?? 0) > 0 ? (\r\n                          <span style={statusBadgeStyle(\"DISPUTED\")}>\r\n                            {i.disputeCount} dispute{i.disputeCount === 1 ? \"\" : \"s\"}\r\n                          </span>\r\n                        ) : null}\r\n                        <span style={statusBadgeStyle(i.status)}>{i.status}</span>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div\r\n                      style={sectionCard({\r\n                        marginTop: \"0.75rem\",\r\n                        padding: \"0.8rem\",\r\n                        borderRadius: 14,\r\n                      })}\r\n                    >\r\n                      <div\r\n                        style={{\r\n                          display: \"grid\",\r\n                          gridTemplateColumns: \"repeat(auto-fit, minmax(110px, 1fr))\",\r\n                          gap: \"0.55rem\",\r\n                        }}\r\n                      >\r\n                        <div>\r\n                          <div style={{ opacity: 0.68, fontSize: 12 }}>Total</div>\r\n                          <div style={{ fontWeight: 800 }}>{money(Number(i.total ?? 0))}</div>\r\n                        </div>\r\n                        <div>\r\n                          <div style={{ opacity: 0.68, fontSize: 12 }}>Balance</div>\r\n                          <div style={{ fontWeight: 800 }}>{money(Number(i.balance ?? 0))}</div>\r\n                        </div>\r\n                        <div>\r\n                          <div style={{ opacity: 0.68, fontSize: 12 }}>Due date</div>\r\n                          <div style={{ fontWeight: 700 }}>{formatDate(i.due_date)}</div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div style={{ opacity: 0.72, fontSize: 12, marginTop: \"0.65rem\" }}>\r\n                      {dueMeta}\r\n                    </div>\r\n\r\n                    <div\r\n                      style={{\r\n                        display: \"flex\",\r\n                        gap: \"0.5rem\",\r\n                        flexWrap: \"wrap\",\r\n                        marginTop: \"0.7rem\",\r\n                      }}\r\n                    >\r\n                      <button className=\"btn\" type=\"button\" disabled>\r\n                        View\r\n                      </button>\r\n                      <button className=\"btn\" type=\"button\" disabled>\r\n                        Edit\r\n                      </button>\r\n                      <button className=\"btn\" type=\"button\" disabled>\r\n                        Resend\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </section>\r\n\r\n      <style jsx>{`\r\n        [data-builder-grid=\"true\"] {\r\n          min-width: 0;\r\n        }\r\n\r\n        [data-builder-grid=\"true\"] > * {\r\n          min-width: 0;\r\n        }\r\n\r\n        @media (min-width: 981px) {\r\n          [data-summary-card=\"true\"] {\r\n            position: sticky !important;\r\n            top: 12px;\r\n          }\r\n        }\r\n\r\n        @media (max-width: 980px) {\r\n          [data-builder-grid=\"true\"] {\r\n            grid-template-columns: 1fr !important;\r\n          }\r\n        }\r\n\r\n        @media (max-width: 640px) {\r\n          .panel {\r\n            padding: 0.8rem !important;\r\n          }\r\n        }\r\n      `}</style>\r\n    </AppShell>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}